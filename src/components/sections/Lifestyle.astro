---
/**
 * Lifestyle Section
 * Une expérience de vie à imaginer
 * Immersive editorial gallery with spec anchors
 */
import InteractiveImageCard from "../ui/InteractiveImageCard.astro";
import AnimatedOrbs from "../ui/AnimatedOrbs.astro";
import Button from "../ui/Button.astro";

// Import Lifestyle Images
import arch04 from "../../assets/arch04.avif";
import arch15 from "../../assets/arch15.avif";
import arch32 from "../../assets/arch32.avif";
import arch24 from "../../assets/arch24.avif";
import arch26 from "../../assets/arch26.avif";
import arch06 from "../../assets/arch06.avif";
import arch12 from "../../assets/arch12.avif";
import arch01 from "../../assets/arch01.avif";
---

<section
  class="lifestyle"
  data-section="lifestyle"
  id="lifestyle"
  aria-labelledby="lifestyle-title"
>
  <div class="lifestyle__container">
    <!-- 1. INTRODUCTION -->
    <header class="lifestyle__header" data-animate="lifestyle-header">
      <h2 id="lifestyle-title" class="lifestyle__title type-h2">
        Un cadre de vie pensé pour le quotidien
      </h2>
      <p class="lifestyle__subtitle type-body-lg">
        Des espaces de vie confortables, lumineux et fonctionnels adaptés aux
        usages contemporains.
      </p>
    </header>

    <!-- 3. IMMERSIVE IMAGE GALLERY — 2×2 Grid -->
    <div class="lifestyle__gallery">
      <!-- 2. LIFESTYLE MARQUEE (Infinite Loop) - Moved inside gallery -->
      <div class="lifestyle__marquee" data-animate="lifestyle-marquee">
        <AnimatedOrbs />

        <div class="lifestyle__marquee-inner">
          {
            /* Render list twice for seamless loop */
            [1, 3].map(() => (
              <ul class="lifestyle__marquee-list">
                <li>Lumière naturelle maîtrisée</li>
                <li class="dot" />
                <li>Espaces ouverts</li>
                <li class="dot" />
                <li>Confort durable</li>
                <li class="dot" />
                <li>Matériaux nobles</li>
                <li class="dot" />
                <li>Ambiances équilibrées</li>
                <li class="dot" />
              </ul>
            ))
          }
        </div>
      </div>
      <!-- Row 1 -->
      <div class="lifestyle__row" data-animate="lifestyle-row-1">
        <InteractiveImageCard
          title="Ouverture extérieur-intérieur"
          description="Une transition fluide entre vos espaces de vie et l'horizon."
          placeholderText="Transition – rendu à venir"
          src={arch04.src}
          specs={[
            { icon: "◎", text: "Lumière naturelle" },
            { icon: "◎", text: "Terrasse large" },
            { icon: "◎", text: "Baies vitrées" },
          ]}
        />
        <InteractiveImageCard
          title="Double Séjour"
          description="L'harmonie parfaite entre salon intérieur et terrasse, pour une sensation d'espace décuplée."
          placeholderText="Séjour – rendu à venir"
          src={arch15.src}
          specs={[
            { icon: "◎", text: "Volumes généreux" },
            { icon: "◎", text: "Double exposition" },
            { icon: "◎", text: "Convivialité" },
          ]}
        />
      </div>

      <!-- Row 2 -->
      <div class="lifestyle__row" data-animate="lifestyle-row-2">
        <InteractiveImageCard
          title="Espace Piscine"
          description="Un havre de fraîcheur et de détente au cœur de la résidence."
          placeholderText="Piscine – rendu à venir"
          src={arch32.src}
          specs={[
            { icon: "◎", text: "Espace détente" },
            { icon: "◎", text: "Soleil toute la journée" },
            { icon: "◎", text: "Cadre paisible" },
          ]}
        />
        <InteractiveImageCard
          title="Parking Privatif"
          description="Un accès sécurisé et pratique pour votre confort au quotidien."
          placeholderText="Garage – rendu à venir"
          src={arch24.src}
          specs={[
            { icon: "◎", text: "Accès sécurisé" },
            { icon: "◎", text: "Places larges" },
            { icon: "◎", text: "Prise électrique" },
          ]}
        />
      </div>

      <!-- Row 3 -->
      <div class="lifestyle__row" data-animate="lifestyle-row-3">
        <InteractiveImageCard
          title="Cuisine Équipée"
          description="Un design contemporain alliant ergonomie et convivialité."
          placeholderText="Cuisine – rendu à venir"
          src={arch26.src}
          specs={[
            { icon: "◎", text: "Matériaux haut de gamme" },
            { icon: "◎", text: "Îlot central" },
            { icon: "◎", text: "Plan de travail" },
          ]}
        />
        <InteractiveImageCard
          title="Salle de Bains"
          description="Élégance et sérénité pour vos moments de bien-être."
          placeholderText="Salle de bains – rendu à venir"
          src={arch06.src}
          specs={[
            { icon: "◎", text: "Douche italienne" },
            { icon: "◎", text: "Meuble vasque" },
            { icon: "◎", text: "Design épuré" },
          ]}
        />
      </div>

      <!-- Row 4 -->
      <div class="lifestyle__row" data-animate="lifestyle-row-4">
        <InteractiveImageCard
          title="Chambre Parentale"
          description="Un refuge intime et lumineux propice à la relaxation."
          placeholderText="Chambre – rendu à venir"
          src={arch12.src}
          specs={[
            { icon: "◎", text: "Parquet chêne" },
            { icon: "◎", text: "Dressing intégré" },
            { icon: "◎", text: "Calme absolu" },
          ]}
        />
        <InteractiveImageCard
          title="Espaces Verts"
          description="Le plaisir d'une nature omniprésente au pied de chez vous."
          placeholderText="Extérieur – rendu à venir"
          src={arch01.src}
          specs={[
            { icon: "◎", text: "Jardins paysagers" },
            { icon: "◎", text: "Biodiversité" },
            { icon: "◎", text: "Détente" },
          ]}
        />
      </div>
    </div>

    <!-- 4. ACTION CTA -->
    <div
      style="display: flex; justify-content: center;"
      data-animate="lifestyle-action"
    >
      <Button href="#" variant="primary" class="js-download-brochure">
        Télécharger la plaquette
      </Button>
    </div>

    <!-- 5. CLOSING NOTE -->
    <aside class="lifestyle__note" data-animate="lifestyle-note">
      <p class="lifestyle__note-text">
        Les prestations détaillées et les plans seront fournis dans la notice
        descriptive.
      </p>
    </aside>
  </div>
</section>

<style>
  @import "../../styles/lifestyle.css";
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const section = document.querySelector(".lifestyle");
    if (!section) return;

    const ease = "power2.out";

    // ========================================
    // 2. HEADER REVEAL
    // ========================================
    gsap.fromTo(
      '[data-animate="lifestyle-header"]',
      { opacity: 0, y: 40 },
      {
        opacity: 1,
        y: 0,
        duration: 1.2,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="lifestyle-header"]',
          start: "top 80%",
          once: true,
        },
      },
    );

    // ========================================
    // 3. SCROLL-INTERACTIVE MARQUEE
    // ========================================
    gsap.to(".lifestyle__marquee-inner", {
      xPercent: -50,
      ease: "none",
      scrollTrigger: {
        trigger: ".lifestyle",
        start: "top bottom",
        end: "bottom top",
        scrub: 1.5, // Slightly loose for elegant secondary motion
      },
    });

    // ========================================
    // 4. RESPONSIVE SCALE ANIMATION
    // ========================================
    const rows = document.querySelectorAll(".lifestyle__row");

    ScrollTrigger.matchMedia({
      // Desktop: Animate entire row together
      "(min-width: 900px)": function () {
        rows.forEach((row) => {
          gsap.fromTo(
            row,
            { scale: 0.92, opacity: 1 },
            {
              scale: 1,
              opacity: 1,
              ease: "none",
              scrollTrigger: {
                trigger: row,
                start: "top 92%",
                end: "top 60%",
                scrub: 1,
              },
            },
          );
        });
      },

      // Mobile: Animate each card individually
      "(max-width: 899px)": function () {
        rows.forEach((row) => {
          const cards = row.querySelectorAll(".interactive-card");
          cards.forEach((card) => {
            // 1. Scale Animation (Visual entry)
            gsap.fromTo(
              card,
              { scale: 0.92, opacity: 1 },
              {
                scale: 1,
                opacity: 1,
                ease: "none",
                scrollTrigger: {
                  trigger: card,
                  start: "top 85%",
                  end: "top 55%",
                  scrub: 1,
                },
              },
            );

            // 2. Active Toggle (Interaction imitation)
            ScrollTrigger.create({
              trigger: card,
              start: "top 20%", // Trigger around center (slightly lower to ensure it activates when dominant)
              end: "bottom top",
              toggleClass: "is-active",
            });
          });
        });
      },
    });

    // Parallax (Shared logic, safe to keep outside or duplicated if needed)
    rows.forEach((row) => {
      const images = row.querySelectorAll(".interactive-card__img");
      images.forEach((img) => {
        gsap.to(img, {
          y: "15%",
          ease: "none",
          scrollTrigger: {
            trigger: row,
            start: "top bottom",
            end: "bottom top",
            scrub: true,
          },
        });
      });
    });

    // ========================================
    // 5. CLOSING NOTE
    // ========================================
    gsap.fromTo(
      '[data-animate="lifestyle-note"]',
      { opacity: 0 },
      {
        opacity: 1,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="lifestyle-note"]',
          start: "top 85%",
          once: true,
        },
      },
    );

    gsap.fromTo(
      '[data-animate="lifestyle-action"]',
      { opacity: 0, y: 20 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="lifestyle-action"]',
          start: "top 85%",
          once: true,
        },
      },
    );
  });
</script>
