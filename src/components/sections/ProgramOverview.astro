---
/**
 * Program Overview Section
 * Le programme — Editorial Information Matrix
 */
import AnimatedVerticalLine from "../ui/AnimatedVerticalLine.astro";
import AnimatedOrbs from "../ui/AnimatedOrbs.astro";
import Button from "../ui/Button.astro";
---

<section
  class="program-overview"
  data-section="programme"
  id="programme"
  aria-labelledby="program-title"
>
  <div class="program-overview__container">
    <!-- 1. HEADER -->
    <header class="program-overview__header" data-animate="program-header">
      <h2 id="program-title" class="program-overview__title type-h2">
        Le programme en quelques mots
      </h2>
      <p class="program-overview__subtitle type-body">
        Une opération à taille humaine, pensée pour s'intégrer harmonieusement
        dans le tissu urbain existant.
      </p>
    </header>

    <!-- 2. PROGRAM SNAPSHOT — Compact Animated Box -->
    <div class="program-overview__snapshot" data-animate="program-snapshot">
      <AnimatedOrbs />

      <div class="program-overview__strip">
        <!-- Top: Key Number with Glow -->
        <div class="program-overview__number-block">
          <span class="program-overview__number type-display">~10</span>
          <span class="program-overview__number-label type-label"
            >Logements</span
          >
        </div>

        <!-- Bottom: Feature Tags -->
        <div class="program-overview__features">
          <div class="program-overview__feature">
            <span class="program-overview__feature-dot"></span>
            <span class="program-overview__feature-text type-body-sm"
              >Programme Mixte</span
            >
          </div>
          <div class="program-overview__feature">
            <span class="program-overview__feature-dot"></span>
            <span class="program-overview__feature-text type-body-sm"
              >Réhabilitation + Neuf</span
            >
          </div>
          <div class="program-overview__feature">
            <span class="program-overview__feature-dot"></span>
            <span class="program-overview__feature-text type-body-sm"
              >Taille Humaine</span
            >
          </div>
          <div class="program-overview__feature">
            <span class="program-overview__feature-dot"></span>
            <span class="program-overview__feature-text type-body-sm"
              >Architecture Cohérente</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- 3. VERTICAL TIMELINE (Static) -->
    <div class="program-overview__timeline" data-animate="program-timeline">
      <!-- Node 1: Étude & Conception (CURRENT) -->
      <div class="program-overview__node program-overview__node--current">
        <div class="program-overview__node-dot"></div>
        <div class="program-overview__node-content">
          <span class="program-overview__node-label type-label"
            >Étape actuelle</span
          >
          <span class="program-overview__node-title type-h5"
            >Étude & Conception</span
          >
          <p class="program-overview__node-description type-body">
            Définition du programme, études techniques et architecturales en
            cours.
          </p>
        </div>
      </div>

      <!-- Node 2: Autorisations -->
      <div class="program-overview__node">
        <div class="program-overview__node-dot"></div>
        <div class="program-overview__node-content">
          <span class="program-overview__node-label type-label"
            >Prochainement</span
          >
          <span class="program-overview__node-title type-h5"
            >Autorisations administratives</span
          >
          <p class="program-overview__node-description type-body">
            Dépôt et instruction des permis de construire.
          </p>
        </div>
      </div>

      <!-- Node 3: Commercialisation -->
      <div class="program-overview__node program-overview__node--future">
        <div class="program-overview__node-dot"></div>
        <div class="program-overview__node-content">
          <span class="program-overview__node-label type-label">À venir</span>
          <span class="program-overview__node-title type-h5"
            >Commercialisation</span
          >
          <p class="program-overview__node-description type-body">
            Ouverture des réservations et accompagnement personnalisé.
          </p>
        </div>
      </div>

      <!-- Node 4: Travaux -->
      <div class="program-overview__node program-overview__node--future">
        <div class="program-overview__node-dot"></div>
        <div class="program-overview__node-content">
          <span class="program-overview__node-label type-label">À venir</span>
          <span class="program-overview__node-title type-h5">Travaux</span>
          <p class="program-overview__node-description type-body">
            Construction et suivi de chantier.
          </p>
        </div>
      </div>

      <!-- Node 5: Livraison -->
      <div class="program-overview__node program-overview__node--future">
        <div class="program-overview__node-dot"></div>
        <div class="program-overview__node-content">
          <span class="program-overview__node-label type-label">Horizon</span>
          <span class="program-overview__node-title type-h5">Livraison</span>
          <p class="program-overview__node-description type-body">
            Remise des clés et installation des propriétaires.
          </p>
        </div>
      </div>
    </div>

    <!-- 4. VISUAL PLACEHOLDER (Krpano Viewer) -->
    <div
      class="program-overview__visual"
      data-animate="program-visual"
      style="padding: 0; height: 600px; width: 100%; border-radius: 12px; overflow: hidden;"
    >
      <div class="sketchfab-embed-wrapper" style="width:100%; height:100%;">
        <iframe
          title="Apartment RP"
          frameborder="0"
          allowfullscreen
          allow="autoplay; fullscreen; xr-spatial-tracking"
          xr-spatial-tracking
          execution-while-out-of-viewport
          execution-while-not-rendered
          web-share
          src="https://sketchfab.com/models/8b31e163cccd4bafbdf186b6d26d283a/embed?autostart=1&ui_controls=1&ui_infos=0&ui_watermark=0"
          style="width:100%; height:100%;"></iframe>
      </div>
    </div>

    <div
      style="display: flex; justify-content: center; width: 100%;"
      data-animate="program-visual"
    >
      <Button href="#" variant="primary" class="js-download-brochure">
        Télécharger la plaquette
      </Button>
    </div>

    <!-- 5. NOTICE / DISCLAIMER (Preserved) -->
    <aside class="program-overview__notice" data-animate="program-notice">
      <p class="program-overview__discrete">
        Les informations détaillées seront précisées ultérieurement. Ce document
        ne constitue pas un engagement contractuel.
      </p>
    </aside>
  </div>
</section>

<style>
  @import "../../styles/program-overview.css";
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const section = document.querySelector(".program-overview");
    if (!section) return;

    // Calm easing
    const ease = "power2.out";

    // 1. Header reveals first
    gsap.fromTo(
      '[data-animate="program-header"]',
      { opacity: 0, y: 40 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: section,
          start: "top 70%",
        },
      },
    );

    // 2. Snapshot list reveals second
    gsap.fromTo(
      '[data-animate="program-snapshot"]',
      { opacity: 0, y: 40 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="program-snapshot"]',
          start: "top 80%",
        },
      },
    );

    // 3. Timeline reveals (static - no progress animation)
    gsap.fromTo(
      '[data-animate="program-timeline"]',
      { opacity: 0, y: 30 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="program-timeline"]',
          start: "top 80%",
        },
      },
    );

    // 5. Visual placeholder reveals
    gsap.fromTo(
      '[data-animate="program-visual"]',
      { opacity: 0, y: 40 },
      {
        opacity: 1,
        y: 0,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="program-visual"]',
          start: "top 85%",
        },
      },
    );

    // 6. Notice fades in gently
    gsap.fromTo(
      '[data-animate="program-notice"]',
      { opacity: 0 },
      {
        opacity: 1,
        duration: 1,
        ease,
        scrollTrigger: {
          trigger: '[data-animate="program-notice"]',
          start: "top 90%",
        },
      },
    );
  });
</script>
